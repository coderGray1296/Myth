## 数据管理模块技术方案
Myth数据管理平台包含两个子模块
- 将多源异构数据通过抽取、清洗和加载(ETL)过程，持久化存储至下游数据仓库
- 提供上层模块获取数据的接口
### ETL模块
#### STG层
这一部分分析数据的来源，可能来自不同的业务系统也可能来自不同的应用程序等。STG层是根据mapping策略把各个源系统的数据抽取到数据仓库(Data Warehousing,DW)中。STG层主要是面向批处理的形式，如果是流式数据，可以跳过STG层直接进入ODS层。主要作用是减轻源系统的压力，数据备份和便于数据问题追踪。

这一模块使用**ETL**工具和**SQL**相结合的方式抽取多源异构数据。
- 数据来源为**RDBMS**(Mysql,Oracle,Postgresql,DB2)：使用开源ETL工具**Sqoop**，将RDBMS中的数据导入Hadoop中的Hdfs,Hive和HBase中。屏蔽了复杂的编码任务，提高了速度，降低了难度。
- 数据来源为**NoSQL**，包括key-value类数据、文档型数据(各种类型的文件数据如txt,日志数据等)和图数据：通过原生SQL语句实现数据导入。原生SQL操作较为灵活，但是编码复杂，对技术要求比较高。
- 增量更新：对于源数据更新频率较高等数据，必须考虑增量抽取。一般情况下，业务系统会记录业务发生的时间，我们可以用来做增量的标志,每次抽取之前首先判断ODS层中记录最大的时间，然后根据这个时间去业务系统取大于这个时间所有的记录。

##### 开发步骤
1. 分析和了解数据源，挖掘映射关系，设计Mapping文档。
2. 设计物理模型，STG的物理模型一般包括源系统的所有字段和审计字段，例如：源系统名称，源表名称，加载时间，加载方式。可以去掉其他约束条件，比如主键、索引，默认值。
3. 抽取数据，STG层面向异构数据源，使用ETL工具+原生SQL，STG层不做数据转换。
4. 加载数据，STG层一般保留7天或一月的数据。

#### ODS层
ODS层是把STG层数据进行历史存档，保留源系统的所有历史数据，如果是流式的，可以跳过STG层，实时同步到ODS层。主要作用是全量存储源系统的数据和支持下游系统实时查询服务。

##### 开发步骤
1. 设计Mapping文档。
2. 设计物理模型，ODS的物理模型一般包括源系统的所有字段和审计字段，但是和源系统最主要的区别是ODS层加了逻辑删除标记和增量时间戳。因为很多源系统都可能进行物理删除数据，可以根据逻辑标记在后台人工删除数据，保证数据对齐。
3. 抽取数据，ODS层从STG层抽取数据，使用ETL工具+原生SQL，STG层不做数据转换。
4. 加载数据，进行数据比较，判断是否有物理删除情况，如果有打上删除标记。ODS层保留全量数据。

#### DW层
DW层是清洗、规范化的工作区，将数据提交至端数据库。
##### 数据清洗
数据清洗是发现数据质量问题并纠正数据的过程，通用的方法是戴明质量环。
![avatar](https://github.com/coderGray1296/Myth/blob/master/Data%20Management/1.png)
1. 定义数据质量需求，根据业务需求和数据剖析结果确定数据质量需求的优先级。
2. 制定数据质量测量类型。
3. 提交数据质量测量结果表，通常异常数据处理策略有：中断处理、拒绝记录添加到错误事件表和只做标记数据继续处理。
4. 纠正数据，优先级由高到低为：必须在ETL处理、最好在ETL处理、最好在数据源头处理和必须在数据源头处理。

##### 规范化
由于数据仓库的数据来源各个业务系统，每个业务系统相对都是封闭的，他们在命名、取值上都有自己的特点。规范化就是经过标准化、去重、合并、拆分、整合等过程把各个业务系统的数据统一命名，统一取值，建立企业标准版本数据。
1. **数据标准化**：从数据的内容、格式、命名、计算规则等输出为唯一的版本数据，把各个源系统的相同描述对象但是不同取值进行统一，比如：性别字段，有的源系统用0和1或Man和Wonen。通过映射表统一命名为M和F。
2. **删除重复数据**：如果源系统中存在重复数据或者多个源系统维护了相同对象的数据，这时候就要根据保留规则，删除重复数据，只保留唯一的一条数据。
3. **数据共存**：把各个业务系统的数据经过拆分、合并、整合。例如相同的客户号，二个源系统都维护了这个客户的联系方式，这时候就要根据业务规则来选择保留哪那个源系统的值。

### 接口模块
在数据管理系统要向上层应用模块提供获取数据的接口，同时要根据用户权限分配对应操作。
整个系统架构图如下：
![avatar](https://github.com/coderGray1296/Myth/blob/master/Data%20Management/2.png)
